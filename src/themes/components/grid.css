/*
 * IGrid
 * Version: 1.22.0
 */

.i-grid {
  --i-grid-bg: var(--i-color-white);
  --i-grid-header-bg: var(--i-color-gray-100);
  --i-grid-header-bg-hover: var(--i-color-gray-200);
  --i-grid-row-bg: var(--i-color-white);
  --i-grid-row-bg-hover: var(--i-color-blue-50);
  /* --i-grid-row-bg-odd: rgba(var(--i-color-blue-50-rgb), 0.2); */
  --i-grid-row-bg-odd: var(--i-color-gray-50);
  display: flex;
  flex-direction: column;
  border: none;
  border-bottom-right-radius: var(--i-radius-md);
  border-bottom-left-radius: var(--i-radius-md);
  background: var(--i-grid-bg);
  width: 100%;
  overflow: hidden;
  font-size: 14px;

  /* VIEWPORT: scrollable body (vertical + horizontal) */
  .i-grid-viewport {
    width: 100%;
    overflow: auto;

    /* --------------------------------------------------
     * HEADER ROW
     * -------------------------------------------------- */
    i-grid-header-row {
      display: flex;
      border-bottom: var(--i-border);
      background-color: var(--i-grid-header-bg);
      width: 100%;
      font-weight: 600;

      i-grid-header-cell {
        display: inline-flex;
        position: relative; /* needed for resize handle + sticky */
        flex: 1 1 0;
        justify-content: space-between;
        align-items: center;
        gap: 0.25rem;
        cursor: pointer;
        background-color: inherit;
        /* padding: var(--i-padding-2xs) var(--i-padding-lg); */
        padding: var(--i-padding-2xs) var(--i-padding-sm);
        min-width: 0;
        user-select: none;
        text-overflow: ellipsis;
        white-space: nowrap;

        /* frozen header cells: ensure background + top z-index */
        &.i-grid-header-cell--frozen {
          z-index: 15;
          background: var(--i-grid-header-bg);
        }

        &.i-grid-selection-cell--header {
          z-index: 40; /* top-most: header checkbox */
        }

        /* Tree header cell (toggler + checkbox column) */
        &.i-grid-tree-cell--header {
          flex: 0 0 auto;
          justify-content: center;
          z-index: 35; /* between selection (40) and number (25) */
          padding-right: 0.125rem;
          padding-left: 0.125rem;
          width: 40px;
          .i-grid-header-cell__resize-handle {
            display: none;
          }
          .i-grid-header-cell__content {
            display: flex;
            justify-content: end;
            align-items: center;
            padding-right: 2px;
          }
        }

        &.i-grid-header-cell--resizable {
          .i-grid-header-cell__resize-handle {
            position: absolute;
            top: 0;
            right: -4px; /* align handle to the actual column edge */
            z-index: 2;
            cursor: col-resize;
            width: 7px; /* clickable area */
            height: 100%;

            &::before {
              position: absolute;
              top: 6px;
              bottom: 6px;
              left: 3px;
              background-color: var(--i-color-border);
              width: 1px;
              content: '';
            }

            &:hover {
              background-color: rgba(0, 0, 0, 0.05);

              &::before {
                background-color: rgba(0, 0, 0, 0.35);
              }
            }
          }
        }

        &.i-grid-selection-cell {
          flex: 0 0 auto;
          justify-content: center;
          padding-right: 0.125rem;
          padding-left: 0.125rem;
          width: 32px;
          .i-grid-header-cell__resize-handle {
            display: none;
          }
        }

        &.i-grid-number-cell {
          flex: 0 0 auto;
          z-index: 25; /* above frozen headers (15), below selection (40) */
          padding-right: var(--i-padding-lg);
          padding-left: var(--i-padding-lg);
        }

        .i-grid-header-cell__content {
          display: block;
          flex: 1 1 auto;
          min-width: 0;
          max-width: 100%;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          /* &:has(input[type='checkbox']) {
            display: flex;
            justify-content: end;
            align-items: center;
            padding-right: 2px;
          } */
        }

        .i-grid-header-cell__icon {
          display: inline-flex;
          flex: 0 0 auto;
          align-items: center;
        }

        &:hover {
          background-color: var(--i-grid-header-bg-hover);
        }
      }

      /* Auto-generated header cells: min width 140px */
      .i-grid-header-cell--auto {
        min-width: 140px;
      }
    }
  }

  /* sticky header inside viewport when enabled */
  &.i-grid--sticky-header {
    .i-grid-viewport {
      i-grid-header-row {
        position: sticky;
        top: var(--i-grid-sticky-top, 0);
        z-index: 30;
        background-color: var(--i-grid-header-bg);
      }
    }
  }

  /* --------------------------------------------------
   * BODY ROWS
   * -------------------------------------------------- */
  i-grid-row {
    display: flex;
    position: relative;
    z-index: 1; /* above viewport background, below header */
    width: 100%;

    i-grid-cell {
      display: flex;
      position: relative;
      flex: 1 1 0; /* actual basis overridden by inline flex style */
      align-items: center;
      gap: var(--i-spacing-5xs);
      z-index: 1;
      border-bottom: var(--i-border-dotted);

      /* IMPORTANT: no background here, so row hover color is visible */
      background: transparent;
      /* padding: var(--i-padding-2xs) var(--i-padding-lg); */
      padding: var(--i-padding-2xs) var(--i-padding-sm);

      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;

      &.i-grid-selection-cell {
        flex: 0 0 auto;
        justify-content: center;
        background-color: var(--i-grid-row-bg);
        padding-right: 0.125rem;
        padding-left: 0.125rem;
        width: 28px;

        input[type='checkbox'],
        input[type='radio'] {
          margin: 0;
          width: 14px;
          height: 14px;
        }
      }

      &.i-grid-selection-cell--body {
        z-index: 20; /* under header, above other body cells if needed */
      }

      /* Tree body cell (toggler + checkbox column) */
      &.i-grid-tree-cell {
        flex: 0 0 auto; /* it remains non-flexing as a column */

        z-index: 19;
        background-color: var(--i-grid-row-bg);
        padding-right: 0.125rem;
        padding-left: 0.125rem;
        width: auto; /* allow natural expansion */

        /* REMOVE fixed width */
        /* width: 40px; */

        /* ADD shrink/grow-friendly behavior */
        min-width: max-content; /* expand to fit toggler + checkbox + indent */
      }

      &.i-grid-number-cell {
        flex: 0 0 auto;
        justify-content: flex-end;
        z-index: 18; /* above normal cells, below selection cell */
        background-color: var(--i-grid-row-bg);
        padding-right: var(--i-padding-lg);
        padding-left: var(--i-padding-lg);
      }

      /* Auto-generated body cells: min width 140px */
      &.i-grid-cell--auto {
        min-width: 140px;
      }

      /* frozen data cells: only box-shadow, no solid background
       so hover color from row still shows through */
      &.i-grid-cell--frozen {
        z-index: 15;
        box-shadow: 1px 0 2px rgba(var(--i-color-gray-300-rgb), 0.3);
        background-color: #ffffff;
      }

      .i-grid-cell__content {
        display: block;
        flex: 1 1 auto;
        min-width: 0;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      /* legacy tree text wrapper (still safe to keep) */
      .i-grid-cell__content--tree {
        display: inline-flex;
        align-items: center;
        gap: var(--i-spacing-5xs);
        padding-left: 4px;
        min-width: 0;
      }

      /* NEW tree cell content wrapper (used in updated template) */
      .i-grid-tree-cell__content {
        display: inline-flex;
        align-items: center;
        gap: var(--i-spacing-3xs);
        padding-left: 4px;
        min-width: 0;
      }

      .i-grid-tree-toggle {
        display: inline-flex;
        cursor: pointer;
        margin-right: 0px;
      }

      .i-grid-tree-spacer {
        display: inline-flex;
        flex: 0 0 16px;
        cursor: pointer;
        padding-left: 6px;
        width: 16px;
      }

      .i-grid-tree-checkbox {
        flex: 0 0 16px;
        width: 24px;
      }

      .i-grid-tree-text {
        display: inline-block;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      /* Ensure children can shrink, so ellipsis works even with nested elements */
      > * {
        min-width: 0;
      }
    }

    &.i-grid-selection-row {
      cursor: pointer;
    }

    &:nth-of-type(odd) {
      background-color: var(--i-grid-row-bg-odd);

      .i-grid-cell--frozen {
        background-color: var(--i-grid-row-bg-odd);
      }
      .i-grid-selection-cell {
        background-color: var(--i-grid-row-bg-odd);
      }
      .i-grid-number-cell {
        background-color: var(--i-grid-row-bg-odd);
      }
      .i-grid-tree-cell {
        background-color: var(--i-grid-row-bg-odd);
      }

      &::before {
        background-color: var(--i-grid-row-bg-odd);
      }
    }

    &::before {
      position: absolute;
      z-index: 0; /* stays behind all cells */
      inset: 0;
      background-color: transparent;
      content: '';
    }

    &:hover {
      background-color: var(--i-grid-row-bg-hover);

      .i-grid-cell--frozen {
        background-color: var(--i-grid-row-bg-hover);
      }
      .i-grid-selection-cell {
        background-color: var(--i-grid-row-bg-hover);
      }
      .i-grid-number-cell {
        background-color: var(--i-grid-row-bg-hover);
      }
      .i-grid-tree-cell {
        background-color: var(--i-grid-row-bg-hover);
      }

      &::before {
        background-color: var(--i-grid-row-bg-hover);
      }
    }

    &:last-child {
      i-grid-cell {
        border-bottom: none;
      }
    }
  }

  /* --------------------------------------------------
   * FOOTER / PAGINATOR
   * -------------------------------------------------- */
  .i-grid-footer {
    display: flex;
    justify-content: flex-end;
    border-top: 1px solid #dee2e6;
    padding: 0.5rem 0.75rem;
  }
}
