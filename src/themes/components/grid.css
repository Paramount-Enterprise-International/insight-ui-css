/*
 * IGrid
 * Version: 1.24.0 (header group layout)
 */
@layer components {
  .i-grid {
    --i-background-color: var(--i-color-white);
    --i-grid-header-bg: var(--i-color-gray-100);
    --i-grid-header-bg-hover: var(--i-color-gray-200);
    --i-grid-row-bg: var(--i-color-white);
    --i-grid-row-bg-hover: var(--i-color-blue-50);
    --i-grid-row-bg-odd: var(--i-color-gray-50);

    display: flex;
    flex-direction: column;
    border: none;
    border-bottom-right-radius: var(--i-radius-md);
    border-bottom-left-radius: var(--i-radius-md);
    width: 100%;
    min-height: 0; /* allow inner scroll */
    overflow: hidden;
    font-size: 14px;

    /* =========================================================
     * VIEWPORT
     * ========================================================= */
    .i-grid-viewport {
      flex: 1 1 auto;
      width: 100%;
      min-height: 0; /* REQUIRED for flex + overflow */
      overflow: auto;
      overflow: auto;
    }

    /* =========================================================
     * HEADER
     * ========================================================= */
    i-grid-header-row {
      --i-background-color: var(--i-grid-header-bg);
      display: inline-flex;
      position: sticky;
      top: 0;

      /* NEW: allow group wrapper (2 rows) to stretch full header height */
      align-items: stretch;
      z-index: 30;

      /* NEW: make header sizing predictable */
      box-sizing: border-box;
      border-bottom: var(--i-border);
      min-width: 100%;
      font-weight: 600;

      i-grid-header-cell {
        display: inline-flex;
        position: relative;
        flex: 1 1 0;
        justify-content: space-between;
        align-items: center;
        gap: 0.25rem;

        /* default: clickable header (sorting) */
        cursor: pointer;

        /* NEW: predictable sizing */
        box-sizing: border-box;

        /* box-shadow:
          inset -1px -1px 2px rgba(255, 255, 255, 0.5),
          inset 1px 1px 2px rgba(0, 0, 0, 0.01); */

        padding: var(--i-padding-2xs) var(--i-padding-sm);
        min-width: 0;

        user-select: none;

        /* text-align: center; */
        text-overflow: ellipsis;
        white-space: nowrap;

        /* ---- state classes (used by TS) ---- */
        &.i-grid-header-cell--sortable {
          cursor: pointer;
        }

        &.i-grid-header-cell--sorted,
        &.i-grid-header-cell--sorted-asc,
        &.i-grid-header-cell--sorted-desc {
          /* keep minimal; you can style later */
        }

        /* ---- frozen header cell ---- */
        &.i-grid-header-cell--frozen {
          z-index: 15;
        }

        /* ---- auto columns ---- */
        &.i-grid-header-cell--auto {
          min-width: 140px;
        }

        /* ---- header content / icon ---- */
        .i-grid-header-cell__content {
          display: block;
          flex: 1 1 auto;
          min-width: 0;
          max-width: 100%;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .i-grid-header-cell__icon {
          display: inline-flex;
          flex: 0 0 auto;
          align-items: center;
        }

        /* ---- resize handle ---- */
        &.i-grid-header-cell--resizable {
          .i-grid-header-cell__resize-handle {
            position: absolute;
            top: 0;
            right: -4px;
            z-index: 2;
            cursor: col-resize;

            width: 7px;
            height: 100%;
            --i-background-color: none;

            &::before {
              position: absolute;
              top: 0px;
              bottom: 0px;
              left: 3px;

              width: 1px;
              content: '';
              /* --i-background-color: var(--i-border-color); */
              --i-background-color: var(--i-color-gray-200);
            }

            &:hover {
              background-color: var(--i-color-gray-300);

              &::before {
                /* background-color: var(--i-color-gray-400); */
              }
            }
          }
        }

        /* ---- selection header cell (flat-mode) ---- */
        &.i-grid-selection-cell {
          flex: 0 0 auto;
          justify-content: center;
          border-right: 1px solid var(--i-color-gray-200);
          padding-right: 0.125rem;
          padding-left: 0.125rem;
          width: 28px;

          .i-grid-header-cell__resize-handle {
            display: none;
          }
        }

        &.i-grid-selection-cell--header {
          z-index: 40;

          .i-grid-header-cell__content {
            display: flex;
            justify-content: center;
            align-items: center;

            input[type='checkbox'] {
              width: 14px;
              height: 14px;
            }
          }
        }

        /* ---- number header cell ---- */
        &.i-grid-number-cell {
          flex: 0 0 auto;
          z-index: 25;
          padding-right: var(--i-padding-lg);
          padding-left: var(--i-padding-sm);
        }

        /* ---- expand header cell (flat-mode detail rows) ---- */
        &.i-grid-expand-cell {
          z-index: 40;
          border-right: 1px solid var(--i-color-gray-200);
          padding: var(--i-padding-2xs) var(--i-padding-xs);
          .i-grid-header-cell__content {
            overflow: visible;
          }
        }

        &.i-grid-expand-cell--header {
          /* present in template */
        }

        /* ---- tree host header UI (tree mode) ---- */
        .i-grid-tree-head {
          display: inline-flex;
          align-items: center;
          min-width: 0;

          .i-grid-tree-expand-all {
            margin-right: 8px;
          }

          .i-grid-tree-header-checkbox {
            margin-right: 8px;
            width: 14px;
            height: 14px;
          }

          .i-grid-tree-head__title {
            display: inline-block;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          }
        }

        &:hover {
          --i-background-color: var(--i-grid-header-bg-hover);
          .i-grid-header-cell__resize-handle {
            --i-background-color: none;
          }
        }
      }

      /* =========================================================
       * NEW: HEADER GROUP LAYOUT (no resize handle for group for now)
       *
       * Expected DOM:
       * <i-grid-header-cell-group>
       *   <i-grid-header-cell>Group Title</i-grid-header-cell>
       *   <i-grid-header-cell-group-columns>
       *     <i-grid-header-cell>Col 2</i-grid-header-cell>
       *     <i-grid-header-cell>Col 3</i-grid-header-cell>
       *   </i-grid-header-cell-group-columns>
       * </i-grid-header-cell-group>
       * ========================================================= */

      i-grid-header-cell-group {
        display: inline-flex;
        position: relative;

        /* FIX:
         * Don’t let the wrapper be a “flex: 1” column.
         * It must size to the sum of its child columns, otherwise it shrinks
         * (e.g. 410) while children sum is 420 -> causes overlap.
         */
        flex: 0 0 auto;

        /* stack: title row then columns row */
        flex-direction: column;
        align-items: stretch;

        /* NEW: predictable sizing */
        box-sizing: border-box;
        width: max-content;

        min-width: 0;

        /* matches header row background */
        --i-background-color: var(--i-grid-header-bg);

        /* prevent visual overlap into next header cell */
        /* overflow: hidden; */
        border-right: 1px solid var(--i-color-gray-200);

        /* IMPORTANT:
         * group container should not steal click/hover styles from inner cells,
         * but we still want hover feedback when hovering the group area.
         */
        /* &:hover {
          --i-background-color: var(--i-grid-header-bg-hover);
        } */

        /* group title cell (top row) */
        > i-grid-header-cell:first-child {
          /* make sure the title doesn’t affect width math */
          flex: 0 0 auto;

          /* center like a group label */
          justify-content: center;

          /* not sortable for group title by default */
          cursor: default;
          /* NEW: predictable sizing */
          box-sizing: border-box;

          /* keep it visually separated from the 2nd row */
          border-bottom: 1px solid var(--i-color-gray-200);

          /* keep same padding but you can tweak later */
          padding: var(--i-padding-2xs) var(--i-padding-sm);

          /* title should be exactly group width */
          width: 100%;
          text-align: center;

          /* avoid resize handle UI for group title cell */
          .i-grid-header-cell__resize-handle {
            display: none;
          }

          /* if TS accidentally marks it resizable, still hide */
          &.i-grid-header-cell--resizable {
            .i-grid-header-cell__resize-handle {
              display: none;
            }
          }
        }

        i-grid-header-cell-group-columns {
          display: inline-flex;
          flex: 0 0 auto;
          align-items: stretch;

          /* NEW: predictable sizing */
          box-sizing: border-box;

          /* FIX: group width should be sum of children */
          width: max-content;

          min-width: 0;

          /* don’t paint over next column */
          /* overflow: hidden; */

          /* ensure the 2nd row fills remaining height if any */
          > i-grid-header-cell {
            /* FIX: don’t let inner cells shrink (260 + 160 stays 420) */
            flex-shrink: 0;
            align-items: center;

            /* NEW: predictable sizing */
            box-sizing: border-box;
          }
        }

        /* hover behavior: when hovering group wrapper, still show inner hover feel */
        /* &:hover {
          i-grid-header-cell {
            --i-background-color: var(--i-grid-header-bg-hover);
          }
        } */
      }
    }

    /* =========================================================
     * BODY ROWS
     * ========================================================= */
    i-grid-row {
      display: inline-flex;
      position: relative;
      z-index: 1;
      min-width: 100%;

      &.i-grid-selection-row {
        cursor: pointer;
      }

      &::before {
        position: absolute;
        z-index: 0;
        inset: 0;
        content: '';
        --i-background-color: transparent;
        border-bottom: var(--i-border-dotted);
      }

      &:nth-of-type(odd) {
        --i-background-color: var(--i-grid-row-bg-odd);

        &::before {
          --i-background-color: var(--i-grid-row-bg-odd);
        }

        .i-grid-cell--frozen,
        .i-grid-selection-cell,
        .i-grid-number-cell,
        .i-grid-expand-cell {
          --i-background-color: var(--i-grid-row-bg-odd);
        }
      }

      &:hover {
        --i-background-color: var(--i-grid-row-bg-hover);

        &::before {
          --i-background-color: var(--i-grid-row-bg-hover);
        }

        .i-grid-cell--frozen,
        .i-grid-selection-cell,
        .i-grid-number-cell,
        .i-grid-expand-cell {
          --i-background-color: var(--i-grid-row-bg-hover);
        }
      }

      &:last-child {
        i-grid-cell {
          border-bottom: none;
        }
      }
    }

    i-grid-cell {
      display: flex;
      position: relative;
      flex: 1 1 0;
      align-items: center;
      gap: var(--i-spacing-5xs);

      z-index: 1;
      /* border-bottom: var(--i-border-dotted); */

      padding: var(--i-padding-2xs) var(--i-padding-sm);

      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;

      --i-background-color: transparent;

      &.i-grid-cell--auto {
        min-width: 140px;
      }

      /* frozen cells */
      &.i-grid-cell--frozen {
        z-index: 15;
        --i-background-color: #ffffff;
        box-shadow: 1px 0 2px rgba(var(--i-color-gray-300-rgb), 0.3);
        border-bottom: var(--i-border-dotted);
      }

      .i-grid-cell__content {
        display: block;
        flex: 1 1 auto;
        min-width: 0;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      /* ---- selection column (flat-mode) ---- */
      &.i-grid-selection-cell {
        flex: 0 0 auto;
        justify-content: center;
        border-bottom: var(--i-border-dotted);
        padding-right: 0.125rem;
        padding-left: 0.125rem;
        width: 28px;
        --i-background-color: var(--i-grid-row-bg);

        input[type='checkbox'],
        input[type='radio'] {
          margin: 0;
          width: 14px;
          height: 14px;
        }
      }

      &.i-grid-selection-cell--body {
        z-index: 20;
      }

      /* ---- number column ---- */
      &.i-grid-number-cell {
        flex: 0 0 auto;
        justify-content: flex-end;
        z-index: 18;

        --i-background-color: var(--i-grid-row-bg);
        border-bottom: var(--i-border-dotted);
        padding-right: var(--i-padding-lg);
        padding-left: var(--i-padding-sm);
      }

      /* ---- expand column (flat-mode detail rows) ---- */
      &.i-grid-expand-cell {
        flex: 0 0 auto;
        justify-content: center;
        z-index: 20;
        width: 32px;

        --i-background-color: var(--i-grid-row-bg);
        border-bottom: var(--i-border-dotted);
        padding-right: 0.125rem;
        padding-left: 0.125rem;
      }

      &.i-grid-expand-cell--body {
        /* present in template */
      }

      .i-grid-expand-cell__content {
        display: inline-flex;
        justify-content: center;
        align-items: center;
      }

      .i-grid-expand-toggle {
        /* present in template */
      }

      /* ---- tree inline UI (tree host column) ---- */
      .i-grid-tree-inline {
        display: inline-flex;
        align-items: center;
        min-width: 0;
        max-width: 100%;
      }

      .i-grid-tree-indent {
        display: inline-block;
        flex: 0 0 auto;
      }

      .i-grid-tree-toggle {
        display: inline-flex;
        flex: 0 0 auto;
        cursor: pointer;
        margin-right: 8px;
      }

      .i-grid-tree-spacer {
        display: inline-flex;
        flex: 0 0 16px;
        margin-right: 8px;
        width: 16px;
      }

      .i-grid-tree-checkbox,
      .i-grid-tree-radio {
        flex: 0 0 auto;
        margin: 0;
        margin-right: 8px;
        width: 14px;
        height: 14px;
      }

      .i-grid-tree-text {
        display: inline-block;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      > * {
        min-width: 0;
      }
    }

    /* =========================================================
     * DETAIL ROW
     * ========================================================= */
    i-grid-expandable-row {
      display: flex;
      border-bottom: var(--i-border-dotted);
      padding: var(--i-padding-md) var(--i-padding-md);
    }

    /* =========================================================
     * FOOTER / PAGINATOR
     * ========================================================= */
    .i-grid-footer {
      /* display: flex; */
      /* justify-content: flex-end; */
      border-top: 1px solid #dee2e6;
      padding: 0.5rem 0.75rem;

      .i-paginator {
        display: flex;
        align-items: center;
        gap: var(--i-gap-md);
      }
    }
  }
}
